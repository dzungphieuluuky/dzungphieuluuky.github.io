{% if site.post_search %}

<meta name="baseurl" content="{{ site.baseurl }}">

<div id="beautifuljekyll-search-overlay" style="display: none;">
  <!-- Modern search container will be injected by custom-script.js -->
  <!-- Fallback content for non-JS users -->
  <div class="fallback-search" style="display: block;">
    <div id="nav-search-exit" title="Exit search">âœ•</div>
    <input type="text" id="nav-search-input" placeholder="Search">
    <ul id="search-results-container"></ul>
  </div>
  
  <!-- Keep Simple Jekyll Search as fallback -->
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    // Initialize Simple Jekyll Search as fallback
    if (typeof SimpleJekyllSearch !== 'undefined') {
      SimpleJekyllSearch({
        searchInput: document.getElementById('nav-search-input'),
        resultsContainer: document.getElementById('search-results-container'),
        json: '{{ site.baseurl }}/assets/data/searchcorpus.json',
        searchResultTemplate: '<li><a href="{url}">{title}</a><br><small>{excerpt}</small></li>',
        noResultsText: 'No results found',
        limit: 10,
        fuzzy: true
      });
    }
    
    // Add event handler for exit button
    document.getElementById('nav-search-exit').addEventListener('click', function() {
      document.getElementById('beautifuljekyll-search-overlay').style.display = 'none';
      document.body.classList.remove('overflow-hidden');
    });
    
    // Hide fallback when modern search loads
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        // Check if modern search has loaded
        if (document.querySelector('.modern-search-container')) {
          const fallback = document.querySelector('.fallback-search');
          if (fallback) {
            fallback.style.display = 'none';
          }
        }
      }, 500); // Increased timeout for better reliability
    });
  </script>
</div>

<div class="search-container">
  <div class="search-wrapper" id="searchWrapper">
    <input 
      type="text" 
      class="search-input" 
      id="searchInput"
      placeholder="Search posts, topics, or dive deeper..." 
      autocomplete="off"
    >
    <button class="search-button" id="searchButton" type="submit">
      <svg class="search-icon" viewBox="0 0 24 24">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
    </button>
    
    <div class="search-results" id="searchResults">
      <!-- Search results will be populated here -->
      <div class="search-categories">
        <div class="search-categories-title">Popular Topics</div>
        <div class="search-category-tags">
          <span class="search-category-tag">Reinforcement Learning</span>
          <span class="search-category-tag">Quantum Computing</span>
          <span class="search-category-tag">Mathematics</span>
          <span class="search-category-tag">Physics</span>
        </div>
      </div>
    </div>
  </div>
</div>

{% endif %}