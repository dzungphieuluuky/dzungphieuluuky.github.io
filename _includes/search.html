{% if site.post_search %}

<!-- Search Button -->
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"></path>
        </svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path>
          </svg>
        </button>
      </nav>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Search Trigger Button -->
<button class="md-header__button md-icon" type="button" id="search-trigger" aria-label="Search">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"></path>
  </svg>
</button>

<style>
/* Material Design Search Styles */
.md-search {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 200;
  opacity: 0;
  visibility: hidden;
  transition: opacity 250ms cubic-bezier(0.1, 0.7, 0.1, 1), visibility 0ms 250ms;
}

.md-search[data-md-state="active"] {
  opacity: 1;
  visibility: visible;
  transition: opacity 250ms cubic-bezier(0.1, 0.7, 0.1, 1);
}

.md-search__overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.54);
  cursor: pointer;
}

.md-search__inner {
  position: relative;
  display: flex;
  flex-direction: column;
  width: 100%;
  max-width: 680px;
  max-height: 100%;
  margin: 0 auto;
  background: #fff;
  border-radius: 0.1rem;
  box-shadow: 0 0.2rem 0.5rem rgba(0, 0, 0, 0.26), 0 0 0.05rem rgba(0, 0, 0, 0.07);
  transform: translateY(-0.8rem);
  transition: transform 400ms cubic-bezier(0.1, 0.7, 0.1, 1);
}

.md-search[data-md-state="active"] .md-search__inner {
  transform: translateY(0);
}

.md-search__form {
  position: relative;
  display: flex;
  align-items: center;
  padding: 0 1rem;
  background: #fff;
  box-shadow: 0 0 0.6rem rgba(0, 0, 0, 0.07);
  border-radius: 0.1rem 0.1rem 0 0;
}

.md-search__input {
  flex: 1;
  padding: 0.75rem 0;
  font-size: 1rem;
  background: transparent;
  border: none;
  outline: none;
  color: rgba(0, 0, 0, 0.87);
}

.md-search__input::placeholder {
  color: rgba(0, 0, 0, 0.54);
}

.md-search__icon {
  width: 1.5rem;
  height: 1.5rem;
  color: rgba(0, 0, 0, 0.54);
  cursor: pointer;
  transition: color 250ms;
}

.md-search__icon:hover {
  color: rgba(0, 0, 0, 0.87);
}

.md-search__icon svg {
  width: 100%;
  height: 100%;
  fill: currentColor;
}

.md-search__options {
  display: flex;
  margin-left: auto;
}

.md-search__options .md-search__icon {
  margin-left: 0.5rem;
}

.md-search__output {
  flex: 1;
  overflow: hidden;
  border-radius: 0 0 0.1rem 0.1rem;
}

.md-search__scrollwrap {
  height: 100%;
  max-height: 75vh;
  overflow-y: auto;
  background: linear-gradient(#fff 0.1rem, hsla(0, 0%, 100%, 0)), linear-gradient(hsla(0, 0%, 100%, 0), #fff calc(100% - 0.1rem)), radial-gradient(farthest-side at 50% 0, rgba(0, 0, 0, 0.12), transparent), radial-gradient(farthest-side at 50% 100%, rgba(0, 0, 0, 0.12), transparent);
  background-repeat: no-repeat;
  background-size: 100% 1.5rem, 100% 1.5rem, 100% 0.5rem, 100% 0.5rem;
  background-attachment: local, local, scroll, scroll;
}

.md-search-result {
  color: rgba(0, 0, 0, 0.87);
}

.md-search-result__meta {
  padding: 0.75rem 1rem;
  font-size: 0.64rem;
  font-weight: 700;
  color: rgba(0, 0, 0, 0.54);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  background: rgba(0, 0, 0, 0.035);
  scroll-snap-align: start;
}

.md-search-result__list {
  margin: 0;
  padding: 0;
  list-style: none;
}

.md-search-result__item {
  border-bottom: 0.05rem solid rgba(0, 0, 0, 0.12);
}

.md-search-result__item:last-child {
  border-bottom: none;
}

.md-search-result__link {
  display: block;
  padding: 0.5rem 1rem;
  text-decoration: none;
  color: inherit;
  scroll-snap-align: start;
  transition: background-color 250ms;
}

.md-search-result__link:hover,
.md-search-result__link:focus,
.md-search-result__link[data-md-state="active"] {
  background: rgba(82, 108, 254, 0.1);
}

.md-search-result__more summary {
  display: block;
  padding: 0.75rem 1rem;
  color: rgba(0, 0, 0, 0.54);
  font-size: 0.64rem;
  text-transform: uppercase;
  cursor: pointer;
  transition: color 250ms, background-color 250ms;
  scroll-snap-align: start;
}

.md-search-result__more summary:hover,
.md-search-result__more summary:focus {
  color: rgba(0, 0, 0, 0.87);
  background: rgba(0, 0, 0, 0.035);
}

.md-search-result__article {
  position: relative;
  padding-left: 2.2rem;
  overflow: hidden;
}

.md-search-result__icon {
  position: absolute;
  left: 1rem;
  top: 0.5rem;
  color: rgba(0, 0, 0, 0.54);
  width: 0.9rem;
  height: 0.9rem;
}

.md-search-result__title {
  margin: 0.5rem 0;
  font-size: 0.8rem;
  font-weight: 400;
  line-height: 1.4;
}

.md-search-result__teaser {
  margin: 0.5rem 0;
  color: rgba(0, 0, 0, 0.54);
  font-size: 0.64rem;
  line-height: 1.4;
  text-overflow: ellipsis;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
}

.md-search-result mark {
  background: rgba(255, 235, 59, 0.5);
  color: rgba(0, 0, 0, 0.87);
  font-weight: 400;
  text-decoration: none;
}

/* Header Search Button */
.md-header__button {
  position: relative;
  z-index: 1;
  margin: 0.2rem;
  padding: 0.4rem;
  color: currentColor;
  background: transparent;
  border: none;
  border-radius: 1.5rem;
  cursor: pointer;
  transition: background-color 250ms, color 250ms;
}

.md-header__button:hover,
.md-header__button:focus {
  background: rgba(0, 0, 0, 0.1);
}

.md-header__button .md-icon,
.md-header__button svg {
  display: block;
  width: 1.5rem;
  height: 1.5rem;
  fill: currentColor;
}

/* Loading Animation */
.md-search__scrollwrap[data-md-state="loading"] .md-search-result__meta::after {
  display: block;
  content: "";
  width: 0.1rem;
  height: 0.1rem;
  margin-left: 0.25rem;
  background: currentColor;
  border-radius: 0.1rem;
  animation: md-search-result__meta 2s infinite linear alternate;
}

@keyframes md-search-result__meta {
  0%, 33% {
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transform: scale(1);
  }
  66%, 100% {
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transform: scale(0);
  }
}

/* Dark Theme */
@media (prefers-color-scheme: dark) {
  .md-search__inner {
    background: #2d2d2d;
    color: rgba(255, 255, 255, 0.87);
  }
  
  .md-search__form {
    background: #2d2d2d;
  }
  
  .md-search__input {
    color: rgba(255, 255, 255, 0.87);
  }
  
  .md-search__input::placeholder {
    color: rgba(255, 255, 255, 0.54);
  }
  
  .md-search__icon {
    color: rgba(255, 255, 255, 0.54);
  }
  
  .md-search-result {
    color: rgba(255, 255, 255, 0.87);
  }
  
  .md-search-result__meta {
    color: rgba(255, 255, 255, 0.54);
    background: rgba(255, 255, 255, 0.035);
  }
  
  .md-search-result__item {
    border-color: rgba(255, 255, 255, 0.12);
  }
  
  .md-search-result__teaser {
    color: rgba(255, 255, 255, 0.54);
  }
}

/* Mobile Responsive */
@media screen and (max-width: 768px) {
  .md-search__inner {
    margin: 0;
    width: 100%;
    height: 100%;
    max-height: 100%;
    border-radius: 0;
  }
  
  .md-search__form {
    border-radius: 0;
  }
  
  .md-search__scrollwrap {
    max-height: calc(100vh - 3.5rem);
  }
}

/* Smooth transitions */
* {
  box-sizing: border-box;
}

.md-search__input:focus {
  outline: none;
}

/* Hidden state */
.md-search__output[hidden] {
  display: none !important;
}

/* Loading state */
.md-search-result[data-md-state="loading"] .md-search-result__meta {
  color: rgba(0, 0, 0, 0.54);
}

.md-search-result[data-md-state="loading"] .md-search-result__list {
  opacity: 0.5;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchTrigger = document.getElementById('search-trigger');
  const searchContainer = document.querySelector('.md-search');
  const searchInput = document.querySelector('.md-search__input');
  const searchOverlay = document.querySelector('.md-search__overlay');
  const searchReset = document.querySelector('.md-search__options button[type="reset"]');
  const searchResult = document.querySelector('.md-search-result');
  const searchMeta = document.querySelector('.md-search-result__meta');
  const searchList = document.querySelector('.md-search-result__list');
  const searchScrollwrap = document.querySelector('.md-search__scrollwrap');

  let searchTimeout;
  let selectedIndex = -1;
  let searchData = [];

  // Mock search data - replace with your actual data
  const mockSearchData = [
    {
      title: "Getting Started",
      url: "/getting-started/",
      text: "Learn how to get started with this documentation. Installation, configuration, and first steps.",
      type: "page"
    },
    {
      title: "Configuration Guide",
      url: "/configuration/",
      text: "Complete guide to configuration options and advanced settings for your project.",
      type: "page"
    },
    {
      title: "API Reference",
      url: "/api/",
      text: "Complete API reference documentation with examples and detailed explanations.",
      type: "page"
    },
    {
      title: "Why I Started a Blog",
      url: "/_posts/2025-05-14-why-i-started-a-blog/",
      text: "Know why I started this blog and what I hope to achieve with it.",
      type: "post"
    },
    {
      title: "Advanced Examples",
      url: "/examples/advanced/",
      text: "Advanced usage examples and real-world scenarios for experienced users.",
      type: "page"
    }
  ];

  // Initialize search data
  searchData = mockSearchData;

  // Open search
  function openSearch() {
    searchContainer.setAttribute('data-md-state', 'active');
    document.body.style.overflow = 'hidden';
    setTimeout(() => {
      searchInput.focus();
      updateSearchMeta('Type to start searching');
    }, 250);
  }

  // Close search
  function closeSearch() {
    searchContainer.removeAttribute('data-md-state');
    document.body.style.overflow = '';
    searchInput.value = '';
    clearResults();
    selectedIndex = -1;
  }

  // Update search meta
  function updateSearchMeta(text) {
    searchMeta.textContent = text;
  }

  // Clear results
  function clearResults() {
    searchList.innerHTML = '';
    updateSearchMeta('Initializing search');
    searchResult.removeAttribute('data-md-state');
  }

  // Highlight search terms
  function highlightText(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  // Perform search
  function performSearch(query) {
    if (!query || query.length < 2) {
      clearResults();
      return;
    }

    // Show loading state
    searchResult.setAttribute('data-md-state', 'loading');
    searchScrollwrap.setAttribute('data-md-state', 'loading');
    updateSearchMeta('Searching...');

    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const results = searchData.filter(item =>
        item.title.toLowerCase().includes(query.toLowerCase()) ||
        item.text.toLowerCase().includes(query.toLowerCase())
      );

      displayResults(results, query);
    }, 300);
  }

  // Display search results
  function displayResults(results, query) {
    searchResult.removeAttribute('data-md-state');
    searchScrollwrap.removeAttribute('data-md-state');

    if (results.length === 0) {
      updateSearchMeta('No matching documents');
      searchList.innerHTML = '';
      return;
    }

    updateSearchMeta(`${results.length} matching document${results.length !== 1 ? 's' : ''}`);

    searchList.innerHTML = results.map((item, index) => {
      const iconPath = item.type === 'post' ? 
        'M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z' :
        'M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z';

      return `
        <li class="md-search-result__item" data-index="${index}">
          <a href="${item.url}" class="md-search-result__link" data-index="${index}">
            <article class="md-search-result__article md-search-result__article--document">
              <svg class="md-search-result__icon md-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="${iconPath}"></path>
              </svg>
              <h1 class="md-search-result__title">${highlightText(item.title, query)}</h1>
              <p class="md-search-result__teaser">${highlightText(item.text, query)}</p>
            </article>
          </a>
        </li>
      `;
    }).join('');

    selectedIndex = -1;
  }

  // Update selection
  function updateSelection() {
    const items = searchList.querySelectorAll('.md-search-result__link');
    items.forEach((item, index) => {
      if (index === selectedIndex) {
        item.setAttribute('data-md-state', 'active');
        item.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
      } else {
        item.removeAttribute('data-md-state');
      }
    });
  }

  // Navigate results
  function navigateResults(direction) {
    const items = searchList.querySelectorAll('.md-search-result__link');
    if (items.length === 0) return;

    if (direction === 'down') {
      selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
    } else if (direction === 'up') {
      selectedIndex = Math.max(selectedIndex - 1, -1);
    }

    updateSelection();
  }

  // Select result
  function selectResult() {
    const items = searchList.querySelectorAll('.md-search-result__link');
    if (selectedIndex >= 0 && items[selectedIndex]) {
      const url = items[selectedIndex].href;
      if (url) {
        window.location.href = url;
        closeSearch();
      }
    }
  }

  // Event listeners
  searchTrigger.addEventListener('click', openSearch);
  searchOverlay.addEventListener('click', closeSearch);
  
  searchReset.addEventListener('click', (e) => {
    e.preventDefault();
    searchInput.value = '';
    clearResults();
    searchInput.focus();
  });

  searchInput.addEventListener('input', (e) => {
    performSearch(e.target.value.trim());
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    // Open search with Ctrl+K or /
    if ((e.ctrlKey && e.key === 'k') || (e.key === '/' && e.target === document.body)) {
      e.preventDefault();
      openSearch();
    }

    // Close with Escape
    if (e.key === 'Escape' && searchContainer.hasAttribute('data-md-state')) {
      e.preventDefault();
      closeSearch();
    }

    // Navigation in search results
    if (searchContainer.hasAttribute('data-md-state')) {
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        navigateResults('down');
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        navigateResults('up');
      } else if (e.key === 'Enter' && selectedIndex >= 0) {
        e.preventDefault();
        selectResult();
      }
    }
  });

  // Handle result clicks
  searchList.addEventListener('click', (e) => {
    const link = e.target.closest('.md-search-result__link');
    if (link) {
      closeSearch();
    }
  });

  // Initialize
  updateSearchMeta('Initializing search');
});
</script>

{% endif %}